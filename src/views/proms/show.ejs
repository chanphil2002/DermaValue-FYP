<% layout('/layout/boilerplate') %>

<!--begin::App Content Header-->
<div class="app-content-header">
  <!--begin::Container-->
  <div class="container-fluid">
    <div class="row mb-4">
      <div class="col-sm-6">
        <div class="d-flex align-items-center">
          <img
            src="<%= user.profileImageUrl || 
                    'https://res.cloudinary.com/ddohywyci/image/upload/v1743808822/DermaValue/users/m77o7kfexwmqgyhqcfkg.jpg' %>"
            class="user-image rounded-circle shadow me-2"
            alt="User Image"
            style="width: 50px; height: 50px"
          />
          <h3 class="mb-0"><%= user.username %>'s PROM</h3>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <!--begin::Row-->
      <div class="row g-4 mb-3">
        <div class="col-12">
          <div
            class="callout callout-info d-flex justify-content-between align-items-center mb-3"
          >
            <!-- Case ID on the left -->
            <p class="mb-0">Prom Id: <%= prom.id %></p>

            <!-- Clinic and Primary Clinician on the right -->
            <div class="text-end">
              <p class="mb-0">Submitted at: <%= prom.submittedAt %></p>
            </div>
          </div>
        </div>
      </div>
      <!--begin::Progress-->
      <div class="card card-primary card-outline mb-4">
        <!--begin::Header-->
        <div class="card-header">
          <div class="card-title fs-4 font-weight-bold">PROM Form Progress</div>
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body p-4">
          <!-- Loop through the responses and display them -->
          <% if (prom.responses && prom.responses.length > 0) { %>
          <div class="mb-3">
            <h5 class="text-muted">Questions & Scores</h5>
            <ul class="list-group">
              <% prom.responses.forEach((response, index) => { %>
              <li
                class="list-group-item d-flex justify-content-between align-items-center p-3"
              >
                <span class="font-weight-bold"><%= response.question %></span>
                <span class="badge badge-primary badge-pill fs-5 text-dark"
                  ><%= response.score %></span
                >
              </li>
              <% }) %>
            </ul>
          </div>
          <% } else { %>
          <p class="text-warning">No responses available.</p>
          <% } %>

          <!-- Display the total score -->
          <div class="mt-4">
            <h5 class="font-weight-bold text-dark">Total Score</h5>
            <p class="fs-4 text-success"><%= prom.totalScore %></p>
          </div>

          <!-- Display progress based on total score -->
          <div
            class="progress mb-3"
            role="progressbar"
            aria-label="PROM Total Score"
            aria-valuenow="<%= prom.totalScore %>"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div
              class="progress-bar bg-success"
              style="width: <%= prom.totalScore || 0 %>%"
              aria-valuenow="<%= prom.totalScore || 0 %>"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>

          <!-- Show a message indicating the progress completion -->
          <div class="text-center mt-3">
            <span class="font-weight-bold text-muted"
              >Overall Satisfaction Score of: <%= prom.totalScore %>% of the
              full assessment</span
            >
          </div>
        </div>
        <!--end::Body-->
      </div>
      <!--end::Progress-->
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content-->
</div>
